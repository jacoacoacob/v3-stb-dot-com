{% load wagtailcore_tags wagtailsettings_tags icon %}
{% get_settings use_default_site=True %}

{% with settings=settings.core.SiteSettings %}
<header class="navbar" id="navbar">
  <div class="navbar-content">
    <div class="flex items-center space-x-2">
      <a href="/">
        <h1 class="text-2xl font-semibold font-mono">
          {{ settings.brand_name }}
        </h1>
      </a>
    </div>
    <div class="hidden sm:flex items-center space-x-6 text-lg">
      <nav>
        <ul class="flex space-x-6">
          {% for is_active, page in pages %}
          <li>
            <a href="{{ page.url }}" class="{% if is_active %}underline decoration-2 decoration-green-500 {% endif %}">
              {{ page.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </nav>
      <span class="font-thin">|</span>
      <button
        id="toggle-dark-mode"
        title="Toggle light/dark mode"
      >
        {% icon "moon" class="hidden dark:inline h-5 w-5" %}
        {% icon "sun" class="dark:hidden inline h-5 w-5" %}
      </button>
    </div>
    <div class="sm:hidden">
      <button id="mobile-menu-open" class="button button-xs font-mono text-sm font-bold text-slate-700 bg-slate-50 dark:bg-slate-700 dark:text-slate-100">
        Menu
      </button>
    </div>
  </div>
  {% include "partials/breadcrumbs.html" %}
  {% include "partials/mobile-menu.html"  %}
</header>
{% endwith %}

<script type="text/javascript">
  (function() {
    var isBreadcrumbs = "{{ is_breadcrumbs }}" === "True";
    var wasBreadcrumbs = (function() {
      try {
        return JSON.parse(localStorage.wasBreadcrumbs || false);
      } catch (error) {
        console.error(error);
        return false
      }
    })();
  
    localStorage.wasBreadcrumbs = isBreadcrumbs;

    var navbarBreadcrumbs = document.querySelector(".navbar-breadcrumbs");
    var navbarBreadcrumbsList = document.querySelector(".navbar-breadcrumbs-list");
    var navbarBreadcrumbsListWrapper = document.querySelector(".navbar-breadcrumbs-list-wrapper");

    if (isBreadcrumbs) {
      navbarBreadcrumbs.classList.add("h-6");
    }

    if (isBreadcrumbs && !wasBreadcrumbs) {
      navbarBreadcrumbsListWrapper.classList.add(
        "h-0",
        "overflow-hidden",
        "transition-all",
        "duration-300",
      );
      setTimeout(function() {
        navbarBreadcrumbsListWrapper.classList.remove(
          "h-0",
          "opacity-0",
        );
        navbarBreadcrumbsListWrapper.classList.add(
          "h-6",
        );
      });
    }
  })();
</script>
<script type="text/javascript">
  (function () {
    var toggleDarkMode = document.getElementById("toggle-dark-mode");
    var mobileMenuToggleDarkMode = document.getElementById("mobile-menu-appearance")

    if (toggleDarkMode) {
      toggleDarkMode.addEventListener("click", onToggleDarkMode);
      mobileMenuToggleDarkMode.addEventListener("click", onToggleDarkMode);
    }

    function getIsDarkMode() {
      return localStorage.getItem("dark-mode") === "true";
    }

    function setIsDarkMode(bool) {
      localStorage.setItem("dark-mode", JSON.stringify(bool));
    }

    function onToggleDarkMode() {
      setIsDarkMode(!getIsDarkMode());
      updateUI();
    }

    function updateUI() {
      var html = document.querySelector("html");
      if (getIsDarkMode()) {
        html.classList.add("dark");
      } else {
        html.classList.remove("dark");
      }
    }

    updateUI();
  })();
</script>

{% comment %}
{% endcomment %}